// Code generated by girgen. DO NOT EDIT.

package pangoot

import (
	"github.com/diamondburned/gotk4/internal/gextras"
	externglib "github.com/gotk3/gotk3/glib"
)

// #cgo pkg-config: pangoot
// #cgo CFLAGS: -Wno-deprecated-declarations
// #include <glib-object.h>
// #include <pango/pango-ot.h>
import "C"

func init() {
	externglib.RegisterGValueMarshalers([]externglib.TypeMarshaler{
		{T: externglib.Type(C.pango_ot_info_get_type()), F: marshalInfo},
		{T: externglib.Type(C.pango_ot_ruleset_get_type()), F: marshalRuleset},
	})
}

type Info interface {
	gextras.Objector

	// ListScripts obtains the list of available scripts.
	ListScripts(tableType TableType) *Tag
}

// info implements the Info interface.
type info struct {
	gextras.Objector
}

var _ Info = (*info)(nil)

// WrapInfo wraps a GObject to the right type. It is
// primarily used internally.
func WrapInfo(obj *externglib.Object) Info {
	return Info{
		Objector: obj,
	}
}

func marshalInfo(p uintptr) (interface{}, error) {
	val := C.g_value_get_object((*C.GValue)(unsafe.Pointer(p)))
	obj := externglib.Take(unsafe.Pointer(val))
	return WrapInfo(obj), nil
}

// ListScripts obtains the list of available scripts.
func (i info) ListScripts(tableType TableType) *Tag {
	var arg0 *C.PangoOTInfo
	var arg1 C.PangoOTTableType

	arg0 = (*C.PangoOTInfo)(i.Native())
	arg1 = (C.PangoOTTableType)(tableType)

	ret := C.pango_ot_info_list_scripts(arg0, arg1)

	var ret0 *Tag

	{
		var tmp uint32
		tmp = uint32(ret)
		ret0 = *Tag(tmp)
	}

	return ret0
}

// Ruleset: the OTRuleset structure holds a set of features selected from the
// tables in an OpenType font. (A feature is an operation such as adjusting
// glyph positioning that should be applied to a text feature such as a certain
// type of accent.) A OTRuleset is created with pango_ot_ruleset_new(), features
// are added to it with pango_ot_ruleset_add_feature(), then it is applied to a
// GlyphString with pango_ot_ruleset_shape().
type Ruleset interface {
	gextras.Objector

	// AddFeature adds a feature to the ruleset.
	AddFeature(tableType TableType, featureIndex uint, propertyBit uint32)
	// FeatureCount gets the number of GSUB and GPOS features in the ruleset.
	FeatureCount() (nGsubFeatures uint, nGposFeatures uint, guint uint)
	// MaybeAddFeatures: this is a convenience function that for each feature in
	// the feature map array @features converts the feature name to a OTTag
	// feature tag using PANGO_OT_TAG_MAKE() and calls
	// pango_ot_ruleset_maybe_add_feature() on it.
	MaybeAddFeatures(tableType TableType, features *FeatureMap, nFeatures uint) uint
	// Position performs the OpenType GPOS positioning on @buffer using the
	// features in @ruleset
	Position(buffer *Buffer)
	// Substitute performs the OpenType GSUB substitution on @buffer using the
	// features in @ruleset
	Substitute(buffer *Buffer)
}

// ruleset implements the Ruleset interface.
type ruleset struct {
	gextras.Objector
}

var _ Ruleset = (*ruleset)(nil)

// WrapRuleset wraps a GObject to the right type. It is
// primarily used internally.
func WrapRuleset(obj *externglib.Object) Ruleset {
	return Ruleset{
		Objector: obj,
	}
}

func marshalRuleset(p uintptr) (interface{}, error) {
	val := C.g_value_get_object((*C.GValue)(unsafe.Pointer(p)))
	obj := externglib.Take(unsafe.Pointer(val))
	return WrapRuleset(obj), nil
}

// NewRuleset constructs a class Ruleset.
func NewRuleset(info Info) Ruleset {
	var arg1 *C.PangoOTInfo

	arg1 = (*C.PangoOTInfo)(info.Native())

	ret := C.pango_ot_ruleset_new(arg1)

	var ret0 Ruleset

	ret0 = gextras.CastObject(externglib.AssumeOwnership(unsafe.Pointer(ret.Native()))).(Ruleset)

	return ret0
}

// NewRulesetFor constructs a class Ruleset.
func NewRulesetFor(info Info, script pango.Script, language *pango.Language) Ruleset {
	var arg1 *C.PangoOTInfo
	var arg2 C.PangoScript
	var arg3 *C.PangoLanguage

	arg1 = (*C.PangoOTInfo)(info.Native())
	arg2 = (C.PangoScript)(script)
	arg3 = (*C.PangoLanguage)(language.Native())

	ret := C.pango_ot_ruleset_new_for(arg1, arg2, arg3)

	var ret0 Ruleset

	ret0 = gextras.CastObject(externglib.AssumeOwnership(unsafe.Pointer(ret.Native()))).(Ruleset)

	return ret0
}

// NewRulesetFromDescription constructs a class Ruleset.
func NewRulesetFromDescription(info Info, desc *RulesetDescription) Ruleset {
	var arg1 *C.PangoOTInfo
	var arg2 *C.PangoOTRulesetDescription

	arg1 = (*C.PangoOTInfo)(info.Native())
	arg2 = (*C.PangoOTRulesetDescription)(desc.Native())

	ret := C.pango_ot_ruleset_new_from_description(arg1, arg2)

	var ret0 Ruleset

	ret0 = gextras.CastObject(externglib.AssumeOwnership(unsafe.Pointer(ret.Native()))).(Ruleset)

	return ret0
}

// AddFeature adds a feature to the ruleset.
func (r ruleset) AddFeature(tableType TableType, featureIndex uint, propertyBit uint32) {
	var arg0 *C.PangoOTRuleset
	var arg1 C.PangoOTTableType
	var arg2 C.guint
	var arg3 C.gulong

	arg0 = (*C.PangoOTRuleset)(r.Native())
	arg1 = (C.PangoOTTableType)(tableType)
	arg2 = C.guint(featureIndex)
	arg3 = C.gulong(propertyBit)

	C.pango_ot_ruleset_add_feature(arg0, arg1, arg2, arg3)
}

// FeatureCount gets the number of GSUB and GPOS features in the ruleset.
func (r ruleset) FeatureCount() (nGsubFeatures uint, nGposFeatures uint, guint uint) {
	var arg0 *C.PangoOTRuleset
	var arg1 *C.guint // out
	var arg2 *C.guint // out

	arg0 = (*C.PangoOTRuleset)(r.Native())

	ret := C.pango_ot_ruleset_get_feature_count(arg0, &arg1, &arg2)

	var ret0 uint
	var ret1 uint
	var ret2 uint

	ret0 = uint(arg1)

	ret1 = uint(arg2)

	ret2 = uint(ret)

	return ret0, ret1, ret2
}

// MaybeAddFeatures: this is a convenience function that for each feature in
// the feature map array @features converts the feature name to a OTTag
// feature tag using PANGO_OT_TAG_MAKE() and calls
// pango_ot_ruleset_maybe_add_feature() on it.
func (r ruleset) MaybeAddFeatures(tableType TableType, features *FeatureMap, nFeatures uint) uint {
	var arg0 *C.PangoOTRuleset
	var arg1 C.PangoOTTableType
	var arg2 *C.PangoOTFeatureMap
	var arg3 C.guint

	arg0 = (*C.PangoOTRuleset)(r.Native())
	arg1 = (C.PangoOTTableType)(tableType)
	arg2 = (*C.PangoOTFeatureMap)(features.Native())
	arg3 = C.guint(nFeatures)

	ret := C.pango_ot_ruleset_maybe_add_features(arg0, arg1, arg2, arg3)

	var ret0 uint

	ret0 = uint(ret)

	return ret0
}

// Position performs the OpenType GPOS positioning on @buffer using the
// features in @ruleset
func (r ruleset) Position(buffer *Buffer) {
	var arg0 *C.PangoOTRuleset
	var arg1 *C.PangoOTBuffer

	arg0 = (*C.PangoOTRuleset)(r.Native())
	arg1 = (*C.PangoOTBuffer)(buffer.Native())

	C.pango_ot_ruleset_position(arg0, arg1)
}

// Substitute performs the OpenType GSUB substitution on @buffer using the
// features in @ruleset
func (r ruleset) Substitute(buffer *Buffer) {
	var arg0 *C.PangoOTRuleset
	var arg1 *C.PangoOTBuffer

	arg0 = (*C.PangoOTRuleset)(r.Native())
	arg1 = (*C.PangoOTBuffer)(buffer.Native())

	C.pango_ot_ruleset_substitute(arg0, arg1)
}
